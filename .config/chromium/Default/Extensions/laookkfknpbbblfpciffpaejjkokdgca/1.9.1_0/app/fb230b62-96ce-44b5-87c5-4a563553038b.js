var fn_addin=function(s,e,t){var n=n||{};n.styles=n.styles||{},n.commands=n.commands||{},n.dependencies=t||n.dependencies||{},n.styles.style=function(){},n.views=n.views||{},n.collect=n.collect||{},n.models=n.models||{},n.templates=n.templates||{},n.info={widget:!0,placeholderType:"metric",id:"countdown",class:"app-container base-metric metric countdown",region:"top-right",order:"append",addin:"fb230b62-96ce-44b5-87c5-4a563553038b",requiredFeature:"countdown",visibleSetting:"countdownVisible",dependencies:["base_metric"]},s.console.log(s.elapsed()+": "+n.info.id+" started"),n.collect.Countdowns=s.collect.SyncedCollection.extend({initialize:function(e){(e=e||{}).name="countdown",e.sorted=!0,e.transientProps=["random","selected"],e.model=n.models.Countdown,s.collect.SyncedCollection.prototype.initialize.call(this,e)},findPinned:function(){return this.filter(function(e){return!e.get("deleted")&&!e.get("archived")&&e.get("pinned")})},activeItems:function(){var e=this.models.filter(function(e){return!e.get("deleted")}),t=e;try{t=e.sort(function(e,t){return e.get("utcDate")-t.get("utcDate")})}catch(e){}return t}}),n.models.Countdown=Backbone.Model.extend({placeholder:"Countdown",nowString:"Now",todayString:"Today",defaults:function(){return{name:"",pinned:!1,utcDate:s.now(),hasHours:!1,past:!1,deleted:!1,archived:!1,serverSetId:!1,selected:!1,random:!1}},initialize:function(e){e=e||{},this.idAttribute=this.collection.idAttribute||"csid",Backbone.Model.prototype.initialize.call(this,e)},getNameOrPlaceholder:function(){return this.get("name")||this.placeholder},getDetailViewVariables:function(){return{years:this.years,placeholder:this.placeholder}},getViewData:function(){var e=this.formatTime(),t=s.date().getFullYear();this.lastSelectedYear=t,this.years=[];for(var n=t;n<t+5;n++)this.years.push(n);return{id:this.get("id"),pinned:this.get("pinned"),date:new Date(this.get("utcDate")),tooltip:this.generateDateTooltip(),metricType:"Countdown",time:e.number,unit:e.unit,nameOrPlaceholder:this.getNameOrPlaceholder(),placeholder:this.placeholder,years:this.years,archived:this.get("archived"),random:!1}},generateDateTooltip:function(){var e=new Date(this.get("utcDate")),t=s.utils.getFriendlyDate(e);return this.get("hasHours")&&(t+=" "+s.utils.getHoursMinsStr(e)),t},formatTime:function(){var e,t=s.date(),n=new Date(this.get("utcDate")),i=this.calculateTimeLeft(t,n),o=this.get("hasHours"),a="";return i.past!==this.get("past")&&this.save("past",i.past,{silent:!0}),a=o&&i.minsTot<mConst("dateMinsPerHour")?(e=0===i.minsTot?this.nowString:i.minsTot,"m"):o&&i.hoursTot<mConst("dateHoursPerDay")?(e=i.hoursTot,"h"):(e=o||0!==i.nights?i.nights:this.todayString,"d"),i.past&&(a+=" ago"),e!==this.nowString&&e!==this.todayString||(a=""),{number:e,unit:a,timeData:i}},calculateTimeLeft:function(e,t){var n=(t-e)/mConst("dateMsPerMin"),i=n/mConst("dateMinsPerHour"),o=s.utils.nightsBetween(e,t,mConst("dateRolloverHour")),a=n<0;return{nights:Math.abs(o),hoursTot:Math.abs(Math.ceil(i)),minsTot:Math.abs(Math.ceil(n)),past:a}},togglePinned:function(){this.save("pinned",!this.get("pinned"))},toggleArchive:function(){this.save("archived",!this.get("archived"))},delete:function(){this.save("deleted",!0)}}),n.models.CountdownManager=Backbone.Model.extend({initialize:function(){n.collect.countdowns=this.collection=new n.collect.Countdowns,this.collection.fetch({reset:!0})}});var i=n.dependencies.base_metric;return i.info=n.info,n.models.countdownManager=new n.models.CountdownManager,n.styles.style(),n.views.countdown=s.widgetManager.handover("countdown",i.views.BaseMetric,{model:n.models.countdown,region:"top-right",order:"append",metricType:"Countdown",metricTitle:"Countdowns",visibleSetting:"countdownVisible",defaultShowRandomState:!0,metricDescription:"Count down the days until an important date",manager:n.models.countdownManager,detailViewAddin:"countdown_detail",updateInterval:"onWholeMinute"}),s.widgets.push(n.views.countdown),n};m.addinManager&&m.addinManager.registerAddinFn("fb230b62-96ce-44b5-87c5-4a563553038b",fn_addin);